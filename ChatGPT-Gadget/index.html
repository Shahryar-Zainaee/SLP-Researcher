<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatGPT Client â€” GitHub Pages Friendly (HTML Only)</title>
  <!--
  ================================================================
  PURPOSE
  ---------------------------------------------------------------
  Singleâ€‘file HTML chat UI for GitHub Pages (or any static host).
  It connects to your own backend that calls the OpenAI API.

  âœ… Your backend endpoint (prefilled here):
     https://backend-jjae.onrender.com/api/chat

  ðŸ” Security note
     Never include your OpenAI API key in this file. Keep it on the backend.

  ðŸ§¾ Attribution / Citations
     - Authored with assistance from ChatGPT (OpenAI, 2025).
     - Follows the OpenAI Responses API pattern from official docs.
     - UI behaviors (autoâ€‘scroll, timestamps, status) are standard web patterns
       written with ChatGPTâ€™s guidance; no proprietary code copied.

  ðŸ›  How to use
     1) Ensure your backend is live and exposes:
        - POST /api/chat  -> { reply: string }
        - GET  /api/health -> { ok: true }
     2) Open this page on GitHub Pages.
     3) Confirm endpoint at top, Save (optional), Check, then chat.

  Â© 2025 â€” You may reuse/modify. Keep the security notice and attribution.
  ================================================================
  -->
  <style>
    :root{
      --bg:#0f1115; --panel:#0b1322; --panel-2:#111a2b; --border:#243040;
      --fg:#e7ecf5; --muted:#9fb0c7; --accent:#7aa2ff; --user:#1e2a3d; --bot:#141e30;
      --danger:#ff6b6b; --ok:#61d095;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Apple Color Emoji","Segoe UI Emoji";
      display:flex; flex-direction:column; min-height:100vh;
    }
    header{border-bottom:1px solid var(--border); background:var(--panel)}
    .wrap{max-width:960px; margin:0 auto; padding:14px 18px}
    h1{margin:0; font-size:18px; font-weight:650; letter-spacing:.2px}
    main{flex:1; display:flex; flex-direction:column}
    .messages{
      flex:1; overflow-y:auto; padding:18px; gap:10px; display:flex; flex-direction:column;
      background:linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
    }
    .msg{display:flex; gap:10px; align-items:flex-start}
    .bubble{max-width:78ch; width:fit-content; white-space:pre-wrap; word-wrap:break-word; line-height:1.4}
    .msg .who{font-size:12px; color:var(--muted); margin-top:2px}
    .msg.user{justify-content:flex-end}
    .msg.user .bubble{background:var(--user); border:1px solid var(--border); border-radius:12px 12px 4px 12px; padding:10px 12px}
    .msg.bot  .bubble{background:var(--bot);  border:1px solid var(--border); border-radius:12px 12px 12px 4px; padding:10px 12px}
    .timestamp{font-size:11px; color:var(--muted); margin-top:2px}
    .composer{border-top:1px solid var(--border); background:var(--panel)}
    .row{display:flex; align-items:flex-end; gap:10px}
    textarea{
      flex:1; min-height:52px; max-height:200px; resize:vertical; padding:12px;
      border-radius:12px; background:#0c1320; color:var(--fg); border:1px solid var(--border);
    }
    button{
      appearance:none; border:1px solid var(--border); background:#1b2945; color:var(--fg);
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600;
    }
    button:disabled{opacity:.6; cursor:not-allowed}
    .bar{display:flex; gap:10px; justify-content:space-between; align-items:center}
    .left,.right{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .tag{font-size:12px; color:var(--muted); padding:4px 8px; border:1px dashed var(--border); border-radius:999px}
    .error{color:var(--danger)} .ok{color:var(--ok)}
    .spinner{width:16px; height:16px; border:2px solid var(--border); border-top-color:var(--fg); border-radius:50%; animation:spin 1s linear infinite; display:inline-block; vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
    .endpoint{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .endpoint input{
      min-width:320px; max-width:520px; width:50vw; padding:10px 12px; border-radius:10px;
      border:1px solid var(--border); background:#0c1320; color:var(--fg);
    }
    .help{font-size:12px; color:var(--muted); margin-left:8px}
  </style>
</head>
<body>
  <header>
    <div class="wrap bar">
      <div class="left">
        <h1>ChatGPT</h1>
        <span class="tag">Static client for GitHub Pages</span>
      </div>
      <div class="right endpoint">
        <!-- Paste or keep the default endpoint. Itâ€™s saved to localStorage. -->
        <label class="sr-only" for="apiUrl">Endpoint</label>
        <input id="apiUrl" type="text" placeholder="https://backend-jjae.onrender.com/api/chat" />
        <button id="saveEndpoint">Save</button>
        <button id="checkEndpoint" title="Try GET /api/health or POST /api/chat">Check</button>
        <span class="help">Tip: You can also append <code>?api=https://â€¦/api/chat</code> to the page URL.</span>
      </div>
    </div>
  </header>

  <main>
    <div id="messages" class="messages" aria-live="polite" aria-label="Chat messages">
      <!-- A friendly helper message will be inserted by JS the first time. -->
    </div>
  </main>

  <footer class="composer">
    <div class="wrap">
      <div class="row" style="padding:12px 0 16px;">
        <label class="sr-only" for="input">Message</label>
        <textarea id="input" placeholder="Type your messageâ€¦ (Shift+Enter for newline)"></textarea>
        <button id="sendBtn">Send</button>
      </div>
      <div id="status" class="tag" aria-live="polite"></div>
    </div>
  </footer>

  <script>
    // ==============================================================
    // CONFIG & PERSISTENCE (GitHub Pages friendly)
    // ==============================================================
    const LS_KEY = 'chat_api_url';
    const DEFAULT_API_URL = "https://backend-jjae.onrender.com/api/chat"; // <â€” your backend

    function getApiUrl() {
      const v = localStorage.getItem(LS_KEY);
      return v && v.trim() ? v.trim() : DEFAULT_API_URL;
    }
    function setApiUrl(url) {
      localStorage.setItem(LS_KEY, url.trim());
    }

    // ==============================================================
    // DOM ELEMENTS
    // ==============================================================
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const statusEl = document.getElementById('status');
    const apiUrlInput = document.getElementById('apiUrl');
    const saveEndpointBtn = document.getElementById('saveEndpoint');
    const checkEndpointBtn = document.getElementById('checkEndpoint');

    // ==============================================================
    // HELPERS
    // ==============================================================
    function escapeHTML(str){
      return str.replace(/[&<>\"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;'}[s]));
    }
    function fmtTime(d=new Date()){
      const hh=d.getHours().toString().padStart(2,'0');
      const mm=d.getMinutes().toString().padStart(2,'0');
      return `${hh}:${mm}`;
    }
    function autoScroll(){ messagesEl.scrollTop = messagesEl.scrollHeight; }
    function setStatus(text, cls){
      statusEl.textContent = text || '';
      statusEl.classList.remove('error','ok');
      if (cls) statusEl.classList.add(cls);
    }

    function addMessage(role, text){
      const msg=document.createElement('div'); msg.className=`msg ${role}`;
      const block=document.createElement('div'); block.style.display='flex'; block.style.flexDirection='column';
      const who=document.createElement('div'); who.className='who'; who.textContent = role==='user'?'You':'Assistant';
      const bubble=document.createElement('div'); bubble.className='bubble'; bubble.innerHTML=escapeHTML(text);
      const time=document.createElement('div'); time.className='timestamp'; time.textContent=fmtTime();
      block.appendChild(who); block.appendChild(bubble); block.appendChild(time);
      msg.appendChild(block); messagesEl.appendChild(msg); autoScroll();
    }

    function addThinking(){
      const msg=document.createElement('div'); msg.className='msg bot'; msg.dataset.spinner='true';
      const block=document.createElement('div'); block.style.display='flex'; block.style.flexDirection='column';
      const who=document.createElement('div'); who.className='who'; who.textContent='Assistant';
      const bubble=document.createElement('div'); bubble.className='bubble';
      bubble.innerHTML = `<span class="spinner" aria-hidden="true"></span> <span>Thinkingâ€¦</span>`;
      const time=document.createElement('div'); time.className='timestamp'; time.textContent=fmtTime();
      block.appendChild(who); block.appendChild(bubble); block.appendChild(time);
      msg.appendChild(block); messagesEl.appendChild(msg); autoScroll();
      return msg;
    }

    // Insert a friendly helper on first load so the page is never blank
    function insertWelcomeIfEmpty(){
      if (messagesEl.children.length===0){
        const txt = [
          'Welcome! Your endpoint is prefilled as https://backend-jjae.onrender.com/api/chat.',
          'If you need to change it, paste a new one above, click Save, then Check.',
          '',
          'This page is a static UI only â€” your backend must call OpenAI securely. (Authored with assistance from ChatGPT / OpenAI.)'
        ].join('\n');
        addMessage('bot', txt);
      }
    }

    // ==============================================================
    // CONNECTION CHECKS
    // ==============================================================
    async function checkConnection(){
      const base = (getApiUrl()||'').trim();
      if (!base){ setStatus('Set your endpoint first, then click Check.', 'error'); return; }
      setStatus('Checkingâ€¦');

      // derive /api/health from /api/chat
      let healthUrl = base.replace(/\/?chat$/,'');
      if (!/health$/.test(healthUrl)) healthUrl = healthUrl.replace(/\/$/,'') + '/health';

      try{
        const r = await fetch(healthUrl, { method:'GET' });
        if (r.ok){ setStatus('Health check OK', 'ok'); return; }
      }catch(_){ /* ignore and try ping */ }

      try{
        const r2 = await fetch(base, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ message:'ping' })
        });
        if (r2.ok){ setStatus('Ping OK', 'ok'); return; }
        setStatus(`Endpoint responded with HTTP ${r2.status}`, 'error');
      }catch(err){
        console.error(err);
        setStatus('Could not reach endpoint (CORS or URL).', 'error');
      }
    }

    // ==============================================================
    // SEND MESSAGE
    // ==============================================================
    async function sendMessage(){
      const apiUrl = (getApiUrl()||'').trim();
      if (!apiUrl){ setStatus('Please set your endpoint first.', 'error'); return; }

      const text = inputEl.value.trim();
      if (!text) return;

      addMessage('user', text);
      inputEl.value=''; inputEl.style.height='auto';
      sendBtn.disabled=true; setStatus('Sendingâ€¦');
      const thinkingEl = addThinking();

      try{
        const res = await fetch(apiUrl, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify({ message:text })
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const reply = (data && (data.reply ?? data.message ?? data.output ?? '')) || '';
        thinkingEl.remove();
        addMessage('bot', reply || '[Empty reply]');
        setStatus('');
      }catch(err){
        console.error(err);
        thinkingEl.remove();
        addMessage('bot', 'Sorry â€” there was a problem contacting the server.');
        setStatus('Connection error (check endpoint/CORS).', 'error');
      }finally{
        sendBtn.disabled=false; autoScroll();
      }
    }

    // ==============================================================
    // INIT
    // ==============================================================
    function initEndpointUI(){
      // Pre-fill from localStorage or URL ?api=â€¦
      const params = new URLSearchParams(location.search);
      const urlParam = params.get('api');
      const stored = localStorage.getItem(LS_KEY);
      const initial = (urlParam && urlParam.trim()) || (stored && stored.trim()) || DEFAULT_API_URL;
      apiUrlInput.value = initial; // show it in the box
      if (!stored) setApiUrl(initial);

      saveEndpointBtn.addEventListener('click', ()=>{
        const v = apiUrlInput.value.trim();
        if (!v){ setStatus('Endpoint cleared.', 'error'); setApiUrl(''); return; }
        setApiUrl(v);
        setStatus('Endpoint saved.', 'ok');
      });
      checkEndpointBtn.addEventListener('click', checkConnection);
    }

    function initComposer(){
      sendBtn.addEventListener('click', sendMessage);
      inputEl.addEventListener('keydown', (e)=>{
        if (e.key==='Enter' && !e.shiftKey){
          e.preventDefault(); sendMessage();
        }
      });
      inputEl.addEventListener('input', ()=>{
        inputEl.style.height='auto';
        inputEl.style.height=Math.min(inputEl.scrollHeight,200)+'px';
      });
      inputEl.focus();
    }

    // Run init
    initEndpointUI();
    initComposer();
    insertWelcomeIfEmpty();
  </script>
</body>
</html>
