<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatGPT — Single‑file Client</title>
  <!--
    HOW TO USE
    1) This file expects a backend endpoint that accepts POST /api/chat { message: string }
       and returns { reply: string }.
       Use the Node/Express server I shared earlier, or any proxy that calls OpenAI safely.
    2) If your endpoint is different, change API_URL below.
    3) Open this file from your backend's static hosting, or serve it locally alongside server.js.

    SECURITY NOTE
    Never place your OpenAI API key in this file. Keys must stay on the server.
  -->
  <style>
    :root {
      --bg: #0f1115;
      --panel: #0b1322;
      --panel-2: #111a2b;
      --border: #243040;
      --fg: #e7ecf5;
      --muted: #9fb0c7;
      --accent: #7aa2ff;
      --user: #1e2a3d;
      --bot: #141e30;
      --danger: #ff6b6b;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      border-bottom: 1px solid var(--border);
      background: var(--panel);
    }

    .wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 14px 18px;
    }

    h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 650;
      letter-spacing: 0.2px;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 18px;
      gap: 10px;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
    }

    .bubble {
      max-width: 78ch;
      width: fit-content;
      white-space: pre-wrap;
      word-wrap: break-word;
      line-height: 1.4;
    }

    .msg {
      display: flex;
      gap: 10px;
      align-items: flex-start;
    }

    .msg .who {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    .msg.user {
      justify-content: flex-end;
    }

    .msg.user .bubble {
      background: var(--user);
      border: 1px solid var(--border);
      border-radius: 12px 12px 4px 12px;
      padding: 10px 12px;
    }

    .msg.bot .bubble {
      background: var(--bot);
      border: 1px solid var(--border);
      border-radius: 12px 12px 12px 4px;
      padding: 10px 12px;
    }

    .timestamp {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }

    .composer {
      border-top: 1px solid var(--border);
      background: var(--panel);
    }

    .row {
      display: flex;
      align-items: flex-end;
      gap: 10px;
    }

    textarea {
      flex: 1;
      min-height: 52px;
      max-height: 200px;
      resize: vertical;
      padding: 12px;
      border-radius: 12px;
      background: #0c1320;
      color: var(--fg);
      border: 1px solid var(--border);
    }

    button {
      appearance: none;
      border: 1px solid var(--border);
      background: #1b2945;
      color: var(--fg);
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .bar {
      display: flex;
      gap: 10px;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .left,
    .right {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .tag {
      font-size: 12px;
      color: var(--muted);
      padding: 4px 8px;
      border: 1px dashed var(--border);
      border-radius: 999px;
    }

    .error {
      color: var(--danger);
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top-color: var(--fg);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap bar">
      <div class="left">
        <h1>ChatGPT</h1>
        <span class="tag">Client UI</span>
      </div>
      <div class="right">
        <button id="newChatBtn" title="Clear chat">New chat</button>
      </div>
    </div>
  </header>

  <main>
    <div id="messages" class="messages" aria-live="polite" aria-label="Chat messages"></div>
  </main>

  <footer class="composer">
    <div class="wrap">
      <div class="row" style="padding: 12px 0 16px;">
        <label class="sr-only" for="input">Message</label>
        <textarea id="input" placeholder="Type your message… (Shift+Enter for newline)"></textarea>
        <button id="sendBtn">Send</button>
      </div>
      <div id="status" class="tag" aria-live="polite"></div>
    </div>
  </footer>

  <script>
    // ====== CONFIG ======
    const API_URL = "/api/chat"; // Change if your backend endpoint is different.

    // ====== STATE ======
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const newChatBtn = document.getElementById('newChatBtn');
    const statusEl = document.getElementById('status');

    let history = []; // local display history; server may be stateless

    // ====== HELPERS ======
    function escapeHTML(str) {
      return str.replace(/[&<>\"']/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', "'": '&#39;' }[s]));
    }
    function fmtTime(d = new Date()) {
      const hh = d.getHours().toString().padStart(2, '0');
      const mm = d.getMinutes().toString().padStart(2, '0');
      return `${hh}:${mm}`;
    }
    function autoScroll() {
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function setStatus(text, isError = false) {
      statusEl.textContent = text || '';
      statusEl.classList.toggle('error', !!isError);
    }

    function addMessage(role, text) {
      const msg = document.createElement('div');
      msg.className = `msg ${role}`;

      const block = document.createElement('div');
      block.style.display = 'flex';
      block.style.flexDirection = 'column';

      const who = document.createElement('div');
      who.className = 'who';
      who.textContent = role === 'user' ? 'You' : 'Assistant';

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.innerHTML = escapeHTML(text);

      const time = document.createElement('div');
      time.className = 'timestamp';
      time.textContent = fmtTime();

      block.appendChild(who);
      block.appendChild(bubble);
      block.appendChild(time);

      msg.appendChild(block);
      messagesEl.appendChild(msg);
      autoScroll();
    }

    function addThinking() {
      const msg = document.createElement('div');
      msg.className = 'msg bot';
      msg.dataset.spinner = 'true';

      const block = document.createElement('div');
      block.style.display = 'flex';
      block.style.flexDirection = 'column';

      const who = document.createElement('div');
      who.className = 'who';
      who.textContent = 'Assistant';

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.innerHTML = `<span class="spinner" aria-hidden="true"></span> <span>Thinking…</span>`;

      const time = document.createElement('div');
      time.className = 'timestamp';
      time.textContent = fmtTime();

      block.appendChild(who);
      block.appendChild(bubble);
      block.appendChild(time);

      msg.appendChild(block);
      messagesEl.appendChild(msg);
      autoScroll();
      return msg;
    }

    function clearChat() {
      history = [];
      messagesEl.innerHTML = '';
      setStatus('');
      inputEl.focus();
    }

    // ====== SEND ======
    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text) return;

      // UI
      addMessage('user', text);
      inputEl.value = '';
      inputEl.style.height = 'auto';
      sendBtn.disabled = true; setStatus('Sending…');
      const thinkingEl = addThinking();

      try {
        // Minimal payload for widest compatibility.
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const data = await res.json();
        const reply = (data && (data.reply ?? data.message ?? data.output ?? '')) || '';

        // Replace thinking bubble with actual reply
        thinkingEl.remove();
        addMessage('bot', reply || '[Empty reply]');
        setStatus('');
        history.push({ role: 'user', content: text }, { role: 'assistant', content: reply });
      } catch (err) {
        console.error(err);
        thinkingEl.remove();
        addMessage('bot', 'Sorry — there was a problem contacting the server.');
        setStatus('Connection error', true);
      } finally {
        sendBtn.disabled = false;
        autoScroll();
      }
    }

    // ====== EVENTS ======
    sendBtn.addEventListener('click', sendMessage);
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    inputEl.addEventListener('input', () => {
      // autoresize textarea (simple)
      inputEl.style.height = 'auto';
      inputEl.style.height = Math.min(inputEl.scrollHeight, 200) + 'px';
    });
    newChatBtn.addEventListener('click', clearChat);

    // ====== INIT ======
    inputEl.focus();
  </script>
</body>

</html>
